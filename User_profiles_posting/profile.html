<!-- Smart Pet Care - Profile Page -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Pet Care</title>
  <link rel="stylesheet" href="profilestyles.css" />
  <link rel="icon" type="image/x-icon" href="../styles/favicon.png" />
</head>

<body>

  <!-- Navbar -->
  <div class="navbar">
    <div class="nav-brand"><a href="../index.html">Smart Pet Care</a></div>
    <input type="checkbox" id="menu-toggle" class="menu-toggle">
    <label for="menu-toggle" class="menu-icon">☰</label>

    <div class="nav-links">
      <a href="../User_profiles_posting/profile.html">Profile</a>
      <a href="../Searching/search.html">Search</a>
      <a href="../Rebooking/book.html">Book</a>
      <a href="../Feedback/feedback.html">Feedback</a>
      <a href="../Messaging_platform/communication.html">Messaging</a>
      <button id="logoutBtn" class="btn small-btn">Logout</button>
    </div>
  </div>
<!-- Test to see if the user is logged in...? -->
  <script>
document.addEventListener("DOMContentLoaded", async () => {
  const currentUser = Parse.User.current();

  if (!currentUser) {
    console.warn("⚠️ No user session found. Redirecting to login.");
    window.location.href = "../User_login_signup/login.html";
    return;
  }

  try {
    // ✅ Validate session with Back4App
    await currentUser.fetch();
    console.log("✅ User is authenticated with Back4App:", currentUser.getUsername());
  } catch (error) {
    console.error("❌ Session invalid or expired:", error);
    await Parse.User.logOut();
    window.location.href = "../User_login_signup/login.html";
  }
});
</script>

  <main class="container">
    <h1>My Profile</h1>
    <p>Manage your account below</p>

    <!-- Role selection -->
    <div id="roleSelect">
      <p class="role-prompt">What type of profile would you like to create?</p>
      <div class="btn-group">
        <button id="chooseParent" class="btn teal">Create Pet Parent Profile</button>
        <button id="chooseCaretaker" class="btn olive">Create Caretaker Profile</button>
      </div>
    </div>

    <!-- Profile Tabs -->
    <div id="profileTabs" class="hidden">
      <div class="tab-buttons" id="profileRoleTabs">
        <button class="tab-btn active" data-tab="parentTab">Pet Parent</button>
        <button class="tab-btn" data-tab="caretakerTab">Caretaker</button>
      </div>

      <!-- Pet Parent Form -->
      <div id="parentTab" class="tab-content active">
        <form id="parentForm" class="profile-form">
          <h2>Pet Parent Profile</h2>
          <section class="owner-section">
            <label>Upload My Photo:</label>
            <input type="file" id="parentPhoto" accept="image/*" />
            <label>Name:</label>
            <input type="text" id="parentName" placeholder="Your name" />
            <label>Zip Code:</label>
            <input type="text" id="parentZip" placeholder="e.g., 33431" />
          </section>

          <hr class="section-divider" />

          <section class="dog-section">
            <h3>Dog Profile</h3>
            <label>Dog Photo:</label>
            <input type="file" id="dogPhoto" accept="image/*" />
            <label>Dog Name:</label>
            <input type="text" id="dogName" placeholder="e.g., Bella" />
            <label>Age:</label>
            <input type="number" id="dogAge" placeholder="e.g., 4" />
            <label>Breed:</label>
            <input type="text" id="dogBreed" placeholder="e.g., Golden Retriever" />
            <label>Weight (lbs):</label>
            <input type="number" id="dogWeight" placeholder="e.g., 65" />
            <label>Medications:</label>
            <input type="text" id="dogMeds" placeholder="List medications or none" />
            <label>Hypoallergenic?</label>
            <select id="dogHypo">
              <option value="">Select...</option>
              <option>Yes</option>
              <option>No</option>
            </select>
            <label>Bio:</label>
            <textarea id="dogBio" placeholder="Tell us about your dog's personality..."></textarea>
          </section>

          <div class="btn-group">
            <button type="button" id="saveProfile" class="btn teal">Save Profile</button>
            <button type="reset" class="btn olive">Clear</button>
          </div>
        </form>

        <!-- Saved Pet Parent Profile -->
        <section id="savedProfile" class="hidden">
          <div id="profileDisplay"></div>
          <button id="editProfile" class="btn olive">Edit Profile</button>
        </section>
      </div>

      <!-- Caretaker Form -->
      <div id="caretakerTab" class="tab-content">
        <form id="caretakerForm" class="profile-form">
          <h2>Caretaker Profile</h2>
          <label>Upload My Photo:</label>
          <input type="file" id="caretakerPhoto" accept="image/*" />
          <label>Name:</label>
          <input type="text" id="caretakerName" placeholder="Your name" />
          <label>Zip Code:</label>
          <input type="text" id="caretakerZip" placeholder="e.g., 33431" />
          <label>Bio:</label>
          <textarea id="caretakerBio" placeholder="Tell pet owners about yourself..."></textarea>
          <label>Experience:</label>
          <input type="text" id="caretakerExp" placeholder="e.g., 2 years with dogs" />
          <label>Rate (per hour):</label>
          <input type="number" id="caretakerRate" placeholder="e.g., 15" />

          <div class="btn-group">
            <button type="button" id="saveCaretaker" class="btn teal">Save Caretaker Profile</button>
            <button type="reset" class="btn olive">Clear</button>
          </div>
        </form>

        <!-- Saved Caretaker Profile -->
        <section id="savedCaretaker" class="hidden">
          <div id="caretakerDisplay"></div>
          <button id="editCaretaker" class="btn olive">Edit Profile</button>
          <button id="bookCaretaker" class="btn teal hidden">Book Me</button>
        </section>
      </div>
    </div>

    <!-- Profile Content Tabs -->
    <div id="contentTabs" class="hidden">
      <div class="content-tab-buttons">
        <button class="content-tab-btn active" data-content-tab="postsTab">Posts</button>
        <button class="content-tab-btn" data-content-tab="feedbackTab">Feedback</button>
      </div>

      <div id="postsTab" class="content-tab active">
        <h3>My Posts</h3>
        <div id="userPostsContainer">
          <!-- Posts placeholder -->
           <div class="btn-group" style="margin: 20px 0;">
              <button id="goToPostPage" class="btn olive">Go to Post Page</button>
          </div>
        </div>
      </div>

      <div id="feedbackTab" class="content-tab">
        <h3>Feedback</h3>
        <div id="feedbackContainer">
          <!-- Feedback cards placeholder -->
        </div>
      </div>
    </div>
  </main>

  <!-- Back4App -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/parse/3.4.4/parse.min.js"></script>
  <script>
    // Initialize Parse
    Parse.initialize("fefJHvdGDQOAtrHXUOVnX62hq3s2KB8gUViNUWWP", "klHYFmiUyu9MhG0kVa4U5zjuyVyMD0oWpo33gHfb");
    Parse.serverURL = 'https://parseapi.back4app.com/';
  </script>

  <script src="profile.js"></script>

</html>